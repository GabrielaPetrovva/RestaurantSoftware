<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Waiter Dashboard ‚Äî Mobile</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
  --bg: #fbfaf8;
  --surface: #ffffff;
  --muted: #8b8b8b;
  --border: #d6d3cd;
  --accent-blue: #2b7be9;
  --accent-green: #2f9a66;
  --accent-orange: #d99334;
  --accent-darkgreen: #256b49;
  --danger: #e53935;
  --radius-lg: 14px;
  --radius-md: 10px;
  --shadow-subtle: 0 2px 0 rgba(0,0,0,0.04) inset;
}

*{box-sizing: border-box; -webkit-tap-highlight-color: transparent;}
html,body{height:100%; margin:0; padding:0; overflow-x:hidden;}
body{
  background:var(--bg);
  color:#111;
  font-family:'Poppins', system-ui, -apple-system, sans-serif;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  line-height:1.3;
  touch-action: pan-y;
}

/* Header */
header.topbar{
  height:56px;
  background:var(--surface);
  border-bottom:1px solid var(--border);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
  padding:0 12px;
  position:sticky;
  top:0;
  z-index:100;
}
.left-controls { display:flex; align-items:center; gap:10px; }
.title { font-weight:800; font-size:17px; }

/* Top Navigation - Desktop */
nav.top-nav {
  display:none;
}

.user-area{ display:flex; align-items:center; gap:8px; }
select#langSelect{ 
  padding:6px 10px; 
  border-radius:8px; 
  border:1px solid var(--border); 
  background:#fff; 
  font-size:14px;
  font-weight:600;
}
.user-name{ font-weight:600; font-size:14px; display:none; }
button.exit{ 
  background:none; 
  border:none; 
  color:var(--danger); 
  font-weight:700; 
  font-size:14px;
  padding:8px;
  cursor:pointer;
}
button.back-btn{ 
  background:none; 
  border:none; 
  color:var(--accent-blue); 
  font-weight:700; 
  font-size:14px;
  padding:8px 12px;
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:6px;
  border-radius:8px;
  transition:all 0.2s;
}
button.back-btn:hover{ 
  background:#f5f4f3;
}
button.back-btn:active{ 
  opacity:0.8;
}

/* Bottom Navigation (Mobile) */
nav.bottom-nav{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  height:64px;
  background:var(--surface);
  border-top:1px solid var(--border);
  display:flex;
  justify-content:space-around;
  align-items:center;
  z-index:100;
  padding:0 4px;
}
nav.bottom-nav button{
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:4px;
  padding:8px 4px;
  border:none;
  background:transparent;
  border-radius:12px;
  cursor:pointer;
  font-size:11px;
  font-weight:700;
  color:#666;
  transition:all 0.2s;
}
nav.bottom-nav button.active{
  background:#faf7f4;
  color:#111;
}
nav.bottom-nav .icon{ font-size:22px; }

/* Main content */
main.main {
  padding:12px 12px 80px 12px;
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
  min-height:calc(100vh - 56px - 64px);
}

.view{ display:none; }
.view.active{ display:block; }

/* Tables Grid */
.tables-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(140px, 1fr));
  gap:10px;
  padding:8px 0 20px 0;
}
.table-chip{
  padding:16px;
  border-radius:12px;
  border:2px solid var(--border);
  background:var(--surface);
  font-weight:700;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:10px;
  box-shadow:0 1px 3px rgba(0,0,0,0.06);
  cursor:pointer;
  transition:transform 0.1s;
  min-height:100px;
  justify-content:center;
}
.table-chip:active{ transform:scale(0.97); }
.table-chip .name{ font-size:16px; font-weight:800; }
.table-chip .status{ font-weight:700; padding:6px 12px; border-radius:10px; font-size:13px; }
.table-chip .info {
  font-size:12px;
  color:var(--muted);
  font-weight:600;
  margin-top:4px;
  display:none;
}
.table-chip.free { background:#dff2f9; color:#073b46; }
.table-chip.busy { background:#ef8a3a; color:#fff; }
.table-chip.ready { background:#2f9a66; color:#fff; }

/* Card */
.card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius-lg);
  padding:14px;
  margin-bottom:14px;
  box-shadow:0 1px 3px rgba(0,0,0,0.04);
}
.card h2{ font-size:18px; font-weight:800; margin:0 0 10px 0; }
.muted { color:var(--muted); font-weight:500; font-size:14px; }

/* Order Container */
.order-container {
  display:block;
}

/* Order Items */
.order-items{ border-top:1px solid var(--border); padding-top:10px; margin-top:10px; }
.order-item{ 
  display:flex; 
  justify-content:space-between; 
  align-items:flex-start; 
  padding:12px 4px; 
  border-bottom:1px solid rgba(0,0,0,0.03); 
}
.order-item .left { max-width:60%; }
.order-item .name{ font-weight:800; font-size:15px; }
.order-item .meta{ color:var(--muted); font-size:12px; margin-top:4px; }
.order-item .right{ text-align:right; }
.order-item .price{ color:var(--danger); font-weight:800; font-size:15px; margin-bottom:8px; }

.small-btn{
  padding:6px 10px;
  border-radius:8px;
  border:1px solid var(--border);
  background:#fff;
  font-size:12px;
  font-weight:700;
  cursor:pointer;
  margin-left:4px;
}

.order-summary{ 
  display:flex; 
  justify-content:space-between; 
  align-items:center; 
  padding:12px 4px; 
  font-weight:800; 
  font-size:17px;
  border-top:2px solid var(--border);
  margin-top:10px;
}

/* Payment Card */
.payment-card {
  position:static;
}

/* Payments Block */
.payments-block{ 
  background:#f5f4f3; 
  border-radius:12px; 
  padding:12px; 
  border:1px solid var(--border);
  margin-top:10px;
}
.payments-block h3 {
  font-size:16px;
  font-weight:800;
  margin:0 0 12px 0;
}
.payment-types{ display:flex; gap:8px; flex-wrap:wrap; margin:10px 0; }
.pay-btn{ 
  padding:10px 14px; 
  border-radius:12px; 
  border:2px solid var(--border); 
  background:var(--surface); 
  font-weight:700; 
  flex:1;
  min-width:70px;
  text-align:center; 
  cursor:pointer;
  font-size:13px;
}
.pay-btn.active{ background:var(--accent-green); color:#fff; border-color:transparent; }
.amount-row{ font-weight:800; font-size:16px; margin:10px 0; display:flex; justify-content:space-between; }

/* Tips */
.tips{ display:flex; gap:8px; margin:10px 0; flex-wrap:wrap; }
.tip-btn{ 
  padding:10px 14px; 
  border-radius:12px; 
  border:2px solid var(--border); 
  background:var(--surface); 
  font-weight:700; 
  cursor:pointer;
  flex:1;
  min-width:65px;
  text-align:center;
  font-size:13px;
}
.tip-btn.active {
  background:var(--accent-blue);
  color:#fff;
  border-color:var(--accent-blue);
}
input#customTip{ 
  padding:10px; 
  border-radius:10px; 
  border:1px solid var(--border);
  flex:1;
  min-width:90px;
  font-size:14px;
}

/* Comments */
textarea#comments{ 
  width:100%; 
  min-height:70px; 
  padding:10px; 
  border-radius:12px; 
  border:1px solid var(--border); 
  resize:vertical; 
  font-family:inherit; 
  font-size:14px;
  margin-top:8px;
}

/* Complete Button */
button#completePayment{ 
  margin-top:12px; 
  width:100%; 
  padding:14px; 
  border-radius:28px; 
  border:none; 
  background:var(--accent-blue); 
  color:#fff; 
  font-weight:800; 
  font-size:15px; 
  cursor:pointer;
}
button#completePayment:active{ opacity:0.9; }

/* Menu */
.menu { margin-top:8px; }
.categories{ display:flex; gap:8px; overflow-x:auto; -webkit-overflow-scrolling:touch; padding-bottom:4px; }
.cat-btn{ 
  padding:10px 16px; 
  border-radius:12px; 
  border:2px solid var(--border); 
  background:var(--surface); 
  font-weight:700; 
  cursor:pointer;
  white-space:nowrap;
  font-size:13px;
}
.cat-btn.active{ background:#fff; box-shadow:var(--shadow-subtle); }
.menu-items{ display:flex; flex-direction:column; gap:8px; margin-top:10px; }
.menu-item{ 
  display:flex; 
  justify-content:space-between; 
  align-items:center; 
  padding:12px; 
  border-radius:12px; 
  border:1px solid var(--border); 
  background:#fff;
}
.menu-item .mname{ font-weight:700; font-size:14px; }
.menu-item .mprice{ color:var(--muted); font-size:13px; margin-top:2px; }
.menu-item button.add{ 
  padding:8px 16px; 
  border-radius:10px; 
  border:1px solid var(--border); 
  background:#fff; 
  cursor:pointer;
  font-weight:700;
  font-size:13px;
}

/* Delivery List */
.delivery-list{ display:flex; flex-direction:column; gap:10px; margin-top:10px; }
.delivery-row{ 
  display:flex; 
  justify-content:space-between; 
  align-items:center; 
  padding:14px; 
  border-radius:12px; 
  border:1px solid var(--border); 
  background:#fff;
}
.delivery-row .info {
  flex:1;
}
.delivery-row .table {
  font-weight:800;
  font-size:15px;
  margin-bottom:2px;
}
.delivery-row .time {
  color:var(--muted);
  font-size:12px;
}
.delivery-row button.status{ 
  padding:8px 16px; 
  border-radius:12px; 
  border:none; 
  font-weight:700; 
  cursor:pointer; 
  color:#fff;
  font-size:13px;
}

/* Stats */
.stats-list{ display:flex; flex-direction:column; gap:10px; font-size:15px; }
.stats-list > div{ 
  padding:12px; 
  background:#fff; 
  border-radius:10px; 
  border:1px solid var(--border);
  display:flex;
  justify-content:space-between;
}
.stats-list .label {
  font-weight:600;
  color:var(--muted);
}
.stats-list .value {
  font-weight:800;
  font-size:18px;
}

.visually-hidden{ position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden; }

/* Landscape mode adjustments */
@media (orientation: landscape) and (max-height: 500px) {
  main.main{ padding-bottom:70px; }
  .order-item{ padding:8px 4px; }
  .card{ padding:12px; }
}

/* =============================================== */
/* DESKTOP OPTIMIZATIONS - 768px and above */
/* =============================================== */
@media (min-width: 768px) {
  body {
    overflow:hidden;
  }
  
  /* Header - Desktop Enhanced */
  header.topbar{
    height:72px;
    padding:0 32px;
    box-shadow:0 1px 3px rgba(0,0,0,0.05);
  }
  .left-controls { 
    gap:32px; 
  }
  .title { 
    font-size:22px; 
    letter-spacing:-0.5px;
  }
  
  /* Show Top Navigation on Desktop */
  nav.top-nav {
    display:flex;
    gap:8px;
  }
  nav.top-nav button {
    padding:10px 20px;
    border:none;
    background:transparent;
    border-radius:10px;
    cursor:pointer;
    font-size:14px;
    font-weight:700;
    color:#666;
    transition:all 0.2s;
  }
  nav.top-nav button:hover {
    background:#f5f4f3;
  }
  nav.top-nav button.active {
    background:#111;
    color:#fff;
  }
  
  /* Hide Bottom Navigation on Desktop */
  nav.bottom-nav {
    display:none;
  }
  
  /* User Area - Desktop */
  .user-area{ 
    gap:16px;
  }
  select#langSelect{ 
    padding:8px 14px; 
    cursor:pointer;
  }
  .user-name{ 
    display:block;
    color:#111;
  }
  button.exit{ 
    background:var(--danger); 
    color:#fff; 
    padding:10px 20px;
    border-radius:10px;
    transition:all 0.2s;
  }
  button.exit:hover {
    opacity:0.9;
  }
  button.back-btn{ 
    padding:10px 16px; 
    font-size:15px;
  }
  button.back-btn:hover{ 
    background:#f0f0f0;
  }

  /* Main Content - Desktop */
  main.main {
    padding:24px 32px 24px 32px;
    height:calc(100vh - 72px);
  }

  /* Tables Grid - Desktop Enhanced */
  .tables-grid{
    grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));
    gap:16px;
    padding:0;
  }
  .table-chip{
    padding:24px;
    border-radius:16px;
    box-shadow:0 2px 8px rgba(0,0,0,0.06);
    transition:all 0.2s;
    min-height:180px;
  }
  .table-chip:hover{ 
    transform:translateY(-2px); 
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
  }
  .table-chip:active{ transform:translateY(-1px); }
  .table-chip .name{ 
    font-size:24px; 
    margin-bottom:8px;
  }
  .table-chip .status{ 
    padding:8px 16px; 
    font-size:14px;
  }
  .table-chip .info {
    display:block;
    font-size:13px;
    margin-top:auto;
  }
  .table-chip.free { 
    background:linear-gradient(135deg, #dff2f9 0%, #c8e9f5 100%); 
    border-color:#b0ddef;
  }
  .table-chip.busy { 
    background:linear-gradient(135deg, #ef8a3a 0%, #d97629 100%); 
    border-color:transparent;
  }
  .table-chip.busy .info {
    color:rgba(255,255,255,0.9);
  }
  .table-chip.ready { 
    background:linear-gradient(135deg, #2f9a66 0%, #25804f 100%); 
    border-color:transparent;
  }
  .table-chip.ready .info {
    color:rgba(255,255,255,0.9);
  }

  /* Card - Desktop Enhanced */
  .card{
    padding:24px;
    box-shadow:0 2px 8px rgba(0,0,0,0.04);
  }
  .card h2{ 
    font-size:20px; 
    margin:0 0 16px 0; 
  }

  /* Order Container - Two Column Layout */
  .order-container {
    display:grid;
    grid-template-columns:1.5fr 1fr;
    gap:24px;
    align-items:start;
  }

  /* Order Items - Desktop Enhanced */
  .order-items{ 
    padding-top:16px; 
    margin-top:16px; 
  }
  .order-item{ 
    padding:16px; 
    align-items:center;
    transition:background 0.2s;
  }
  .order-item:hover {
    background:#fafafa;
  }
  .order-item .left { 
    flex:1;
    max-width:none;
  }
  .order-item .name{ 
    font-size:16px; 
  }
  .order-item .meta{ 
    font-size:13px; 
  }
  .order-item .right{ 
    display:flex;
    align-items:center;
    gap:12px;
  }
  .order-item .price{ 
    font-size:16px;
    margin-bottom:0;
  }

  .small-btn{
    padding:8px 14px;
    font-size:13px;
    transition:all 0.2s;
    margin-left:0;
  }
  .small-btn:hover {
    background:#f5f4f3;
  }

  .order-summary{ 
    padding:16px; 
    font-size:18px;
    margin-top:16px;
    background:#fafafa;
    border-radius:12px;
  }

  /* Payment Card - Desktop Sticky */
  .payment-card {
    position:sticky;
    top:96px;
  }

  /* Payments Block - Desktop Enhanced */
  .payments-block{ 
    background:var(--surface); 
    border-radius:16px; 
    padding:20px; 
    box-shadow:0 2px 8px rgba(0,0,0,0.04);
    margin-top:0;
  }
  .payments-block h3 {
    font-size:18px;
    margin:0 0 16px 0;
  }
  .payment-types{ 
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px; 
    margin:16px 0; 
  }
  .pay-btn{ 
    padding:14px; 
    font-size:14px;
    transition:all 0.2s;
  }
  .pay-btn:hover {
    border-color:#999;
  }
  .pay-btn.active{ 
    border-color:var(--accent-green); 
  }
  .amount-row{ 
    font-size:18px; 
    margin:16px 0; 
    padding:12px;
    background:#fafafa;
    border-radius:10px;
  }

  /* Tips - Desktop Grid */
  .tips{ 
    display:grid;
    grid-template-columns:repeat(4, 1fr);
    gap:8px; 
    margin:16px 0; 
  }
  .tip-btn{ 
    padding:12px; 
    font-size:14px;
    transition:all 0.2s;
  }
  .tip-btn:hover {
    border-color:#999;
  }
  input#customTip{ 
    padding:12px; 
    width:100%;
    margin-top:8px;
  }

  /* Comments - Desktop */
  textarea#comments{ 
    min-height:80px; 
    padding:12px; 
  }

  /* Complete Button - Desktop Enhanced */
  button#completePayment{ 
    margin-top:16px; 
    padding:16px; 
    border-radius:12px; 
    font-size:16px; 
    transition:all 0.2s;
  }
  button#completePayment:hover{ 
    background:#2369cc;
    transform:translateY(-1px);
  }
  button#completePayment:active{ 
    transform:translateY(0);
    opacity:1;
  }

  /* Menu - Desktop Enhanced */
  .menu { margin-top:16px; }
  .categories{ 
    gap:10px; 
    padding-bottom:8px;
    margin-bottom:16px;
  }
  .cat-btn{ 
    padding:12px 20px; 
    font-size:14px;
    transition:all 0.2s;
  }
  .cat-btn:hover {
    border-color:#999;
  }
  .cat-btn.active{ 
    background:#111; 
    color:#fff;
    border-color:#111;
  }
  .menu-items{ 
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));
    gap:12px;
  }
  .menu-item{ 
    padding:16px; 
    transition:all 0.2s;
  }
  .menu-item:hover {
    box-shadow:0 2px 8px rgba(0,0,0,0.08);
    transform:translateY(-1px);
  }
  .menu-item .mname{ 
    font-size:15px; 
  }
  .menu-item .mprice{ 
    font-size:14px; 
  }
  .menu-item button.add{ 
    padding:10px 20px; 
    font-size:14px;
    transition:all 0.2s;
  }
  .menu-item button.add:hover {
    background:var(--accent-green);
    color:#fff;
    border-color:var(--accent-green);
  }

  /* Delivery List - Desktop Grid */
  .delivery-list{ 
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(350px, 1fr));
    gap:16px; 
    margin-top:16px; 
  }
  .delivery-row{ 
    padding:20px; 
    transition:all 0.2s;
  }
  .delivery-row:hover {
    box-shadow:0 2px 8px rgba(0,0,0,0.08);
  }
  .delivery-row .table {
    font-size:16px;
    margin-bottom:4px;
  }
  .delivery-row .time {
    font-size:13px;
  }
  .delivery-row button.status{ 
    padding:10px 20px; 
    font-size:14px;
    transition:all 0.2s;
  }
  .delivery-row button.status:hover {
    opacity:0.9;
  }

  /* Stats - Desktop Grid */
  .stats-list{ 
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));
    gap:16px;
  }
  .stats-list > div{ 
    padding:20px; 
    transition:all 0.2s;
  }
  .stats-list > div:hover {
    box-shadow:0 2px 8px rgba(0,0,0,0.08);
  }
  .stats-list .value {
    font-size:20px;
  }

}

/* Large Desktop Optimizations */
@media (min-width: 1400px) {
  .tables-grid{
    grid-template-columns:repeat(auto-fill, minmax(320px, 1fr));
  }
  
  .order-container {
    grid-template-columns:1.6fr 1fr;
  }
}
  </style>
</head>
<body>
  <!-- Header -->
  <header class="topbar">
    <div class="left-controls">
      <div class="title" id="appTitle">Waiter Dashboard</div>
    </div>

    <div class="user-area">
      <select id="langSelect">
        <option value="en">EN</option>
        <option value="bg">BG</option>
      </select>
      <span class="user-name">Ivan</span>
      <button class="exit" id="exitBtn">Exit</button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main" id="main">
    <!-- VIEW: Tables -->
    <section id="view-tables" class="view active">
      <div class="card">
        <h2 id="tablesTitle">Tables</h2>
        <p class="muted" id="tablesSubtitle">Tap a table to open or create an order</p>
        <div class="tables-grid" id="tablesGrid"></div>
      </div>
    </section>

    <!-- VIEW: Orders -->
    <section id="view-orders" class="view">
      <button id="backToTablesBtn" class="back-btn" style="margin-bottom:12px;">
        <span>‚Üê</span>
        <span id="backToTablesLabel">Back to Tables</span>
      </button>
      <div class="card">
        <h2 id="orderTitle">Order</h2>
        <div class="order-items" id="orderItems">
          <div class="muted">No order selected. Tap a table to start.</div>
        </div>

        <div class="order-summary">
          <div id="labelTotal">Total</div>
          <div id="totalValue">0.00‚Ç¨</div>
        </div>

        <div class="payments-block">
          <h3 id="paymentsBlockTitle" style="text-align:center; margin:0 0 8px 0; font-size:16px;">Payments</h3>

          <div class="payment-types" id="paymentTypes">
            <button class="pay-btn" data-type="cash">Cash</button>
            <button class="pay-btn" data-type="card">Card</button>
            <button class="pay-btn" data-type="vouchers">Vouchers</button>
            <button class="pay-btn" data-type="online">Online</button>
          </div>

          <div class="amount-row">
            <span id="labelAmount">Amount</span>
            <span id="amountValue">0.00‚Ç¨</span>
          </div>

          <div><strong id="labelTip">Tip</strong></div>
          <div class="tips">
            <button class="tip-btn" data-tip="0.10">10%</button>
            <button class="tip-btn" data-tip="0.20">20%</button>
            <button class="tip-btn" data-tip="0.30">30%</button>
            <input id="customTip" placeholder="‚Ç¨ 0.00" inputmode="decimal" />
          </div>

          <div style="margin-top:8px;"><strong id="labelComments">Comments</strong></div>
          <textarea id="comments" data-placeholder-en="Notes to kitchen/bar" data-placeholder-bg="–ë–µ–ª–µ–∂–∫–∏ –∫—ä–º –∫—É—Ö–Ω—è—Ç–∞/–±–∞—Ä–∞" placeholder="Notes to kitchen/bar"></textarea>

          <button id="completePayment">Complete Payment</button>
        </div>
      </div>

      <div class="card menu">
        <h2 id="menuTitle">Menu</h2>
        <div class="categories" id="categoryRow">
          <button class="cat-btn active" data-cat="pizzas" data-i18n="Pizzas" id="catPizzas">Pizzas</button>
          <button class="cat-btn" data-cat="drinks" data-i18n="Drinks" id="catDrinks">Drinks</button>
          <button class="cat-btn" data-cat="sides" data-i18n="Sides" id="catSides">Sides</button>
        </div>
        <div class="menu-items" id="menuItems"></div>
      </div>
    </section>

    <!-- VIEW: Payments -->
    <section id="view-payments" class="view">
      <div class="card">
        <h2 id="paymentsTitle">Payments</h2>
        <p class="muted">Open checks and payment history</p>
        <div id="checksList" style="margin-top:10px;"></div>
      </div>
    </section>

    <!-- VIEW: Delivery -->
    <section id="view-delivery" class="view">
      <div class="card">
        <h2 id="deliveryTitle">Delivery / Takeaway</h2>
        <p class="muted" id="deliverySubtitle">Incoming Orders</p>
        <div class="delivery-list" id="deliveryList"></div>
        <button id="btnPrintOrders" class="action-btn" style="margin-top:12px; width:100%;">Print Orders</button>
      </div>
    </section>

    <!-- VIEW: Statistics -->
    <section id="view-stats" class="view">
      <div class="card">
        <h2 id="statsTitle">Statistics</h2>
        <div class="stats-list" style="margin-top:10px;">
          <div><span id="statSalesLabel">Sales this shift</span><strong id="statSales">0.00‚Ç¨</strong></div>
          <div><span id="statAvgLabel">Average check</span><strong id="statAvg">0.00‚Ç¨</strong></div>
          <div><span id="statTablesLabel">Served tables</span><strong id="statTables">0</strong></div>
          <div><span id="statTipsLabel">Tips (total)</span><strong id="statTips">0.00‚Ç¨</strong></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <button data-view="tables" class="active">
      <span class="icon">‚ñ¶</span>
      <span>Tables</span>
    </button>
    <button data-view="orders">
      <span class="icon">üìÑ</span>
      <span>Orders</span>
    </button>
    <button data-view="payments">
      <span class="icon">üí≥</span>
      <span id="navPay">Pay</span>
    </button>
    <button data-view="delivery">
      <span class="icon">üöö</span>
      <span>Delivery</span>
    </button>
    <button data-view="stats">
      <span class="icon">üìä</span>
      <span>Stats</span>
    </button>
  </nav>

  <template id="tplTableChip">
    <button class="table-chip">
      <div class="name">Table</div>
      <div class="status">Free</div>
    </button>
  </template>

  <template id="tplMenuItem">
    <div class="menu-item">
      <div>
        <div class="mname">Name</div>
        <div class="mprice muted">1.00‚Ç¨</div>
      </div>
      <button class="add" data-i18n-add="Add">+ Add</button>
    </div>
  </template>

  <!-- ===================== JS (readable & commented) ===================== -->
  <script>
/****************************************************************
 * Waiter Dashboard - Mobile-Optimized JavaScript
 * - Responsive mobile-first layout
 * - BG/EN translations
 * - Main waiter flows: Tables, Orders, Payments, Delivery, Statistics
 ****************************************************************/

/****************************************************************
 * Waiter Dashboard - Mobile-Optimized JavaScript (FIXED)
 * - Responsive mobile-first layout
 * - BG/EN translations
 * - Main waiter flows: Tables, Orders, Payments, Delivery, Statistics
 ****************************************************************/

/* ---------- Translation dictionary ---------- */
const i18n = {
  en: {
    Tables: 'Tables',
    Orders: 'Orders',
    Payments: 'Payments',
    'Delivery/Takeaway': 'Delivery/Takeaway',
    Statistics: 'Statistics',
    'Tap a table to open or create an order': 'Tap a table to open or create an order',
    'Quick Actions': 'Quick Actions',
    'Open Orders': 'Open Orders',
    'Delivery': 'Delivery',
    'Total': 'Total',
    'Amount': 'Amount',
    'Tip': 'TIP',
    'Comments': 'Comments',
    'Complete Payment': 'Complete Payment',
    'Menu': 'Menu',
    'Incoming Orders': 'Incoming Orders',
    'Print Orders': 'Print Orders',
    'Preparing': 'Preparing',
    'Ready': 'Ready',
    'Picked up': 'Picked up',
    'Waiter Dashboard': 'Waiter Dashboard',
    'Exit': 'Exit',
    'Pay': 'Pay',
    'Pizzas': 'Pizzas',
    'Drinks': 'Drinks',
    'Sides': 'Sides',
    'Sales this shift': 'Sales this shift',
    'Average check': 'Average check',
    'Served tables': 'Served tables',
    'Tips (total)': 'Tips (total)',
    'Margherita': 'Margherita',
    'Pepperoni': 'Pepperoni',
    'Quattro Formaggi': 'Quattro Formaggi',
    'Coca-Cola': 'Coca-Cola',
    'Water': 'Water',
    'Orange Juice': 'Orange Juice',
    'Fries': 'Fries',
    'Green Salad': 'Green Salad',
    'Garlic Bread': 'Garlic Bread',
    'Open checks and payment history': 'Open checks and payment history',
    'Add': 'Add',
    'Notes to kitchen/bar': 'Notes to kitchen/bar',
    'Back to Tables': 'Back to Tables'
  },
  bg: {
    Tables: '–ú–∞—Å–∏',
    Orders: '–ü–æ—Ä—ä—á–∫–∏',
    Payments: '–ü–ª–∞—â–∞–Ω–∏—è',
    'Delivery/Takeaway': '–î–æ—Å—Ç–∞–≤–∫–∞/–í–∑–µ–º–∞–Ω–µ',
    Statistics: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
    'Tap a table to open or create an order': '–ù–∞—Ç–∏—Å–Ω–µ—Ç–µ –º–∞—Å–∞ –∑–∞ –Ω–æ–≤–∞ –ø–æ—Ä—ä—á–∫–∞',
    'Open Orders': '–û—Ç–≤–æ—Ä–µ–Ω–∏ –ø–æ—Ä—ä—á–∫–∏',
    'Delivery': '–î–æ—Å—Ç–∞–≤–∫–∞',
    'Total': '–û–±—â–æ',
    'Amount': '–°—É–º–∞',
    'Tip': '–ë–ê–ö–®–ò–®',
    'Comments': '–ë–µ–ª–µ–∂–∫–∏',
    'Complete Payment': '–ó–∞–≤—ä—Ä—à–∏ –ø–ª–∞—â–∞–Ω–µ',
    'Menu': '–ú–µ–Ω—é',
    'Incoming Orders': '–í—Ö–æ–¥—è—â–∏ –ø–æ—Ä—ä—á–∫–∏',
    'Print Orders': '–ü—Ä–∏–Ω—Ç–∏—Ä–∞–π –ø–æ—Ä—ä—á–∫–∏',
    'Preparing': '–í –ø—Ä–æ—Ü–µ—Å',
    'Ready': '–ì–æ—Ç–æ–≤–æ',
    'Picked up': '–í–∑–µ—Ç–æ',
    'Waiter Dashboard': '–¢–∞–±–ª–æ –Ω–∞ —Å–µ—Ä–≤–∏—Ç—å–æ—Ä',
    'Exit': '–ò–∑—Ö–æ–¥',
    'Pay': '–ü–ª–∞—â–∞–Ω–µ',
    'Pizzas': '–ü–∏—Ü–∏',
    'Drinks': '–ù–∞–ø–∏—Ç–∫–∏',
    'Sides': '–ì–∞—Ä–Ω–∏—Ç—É—Ä–∏',
    'Sales this shift': '–ü—Ä–æ–¥–∞–∂–±–∏ —Ç–∞–∑–∏ —Å–º—è–Ω–∞',
    'Average check': '–°—Ä–µ–¥–Ω–∞ —Å–º–µ—Ç–∫–∞',
    'Served tables': '–û–±—Å–ª—É–∂–µ–Ω–∏ –º–∞—Å–∏',
    'Tips (total)': '–ë–∞–∫—à–∏—à (–æ–±—â–æ)',
    'Margherita': '–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞',
    'Pepperoni': '–ü–µ–ø–µ—Ä–æ–Ω–∏',
    'Quattro Formaggi': '–ö–≤–∞—Ç—Ä–æ –§–æ—Ä–º–∞–¥–∂–∏',
    'Coca-Cola': '–ö–æ–∫–∞-–ö–æ–ª–∞',
    'Water': '–í–æ–¥–∞',
    'Orange Juice': '–ü–æ—Ä—Ç–æ–∫–∞–ª–æ–≤ —Å–æ–∫',
    'Fries': '–ü—ä—Ä–∂–µ–Ω–∏ –∫–∞—Ä—Ç–æ—Ñ–∏',
    'Green Salad': '–ó–µ–ª–µ–Ω–∞ —Å–∞–ª–∞—Ç–∞',
    'Garlic Bread': '–ß–µ—Å–Ω–æ–≤ —Ö–ª—è–±',
    'Open checks and payment history': '–û—Ç–≤–æ—Ä–µ–Ω–∏ —Å–º–µ—Ç–∫–∏ –∏ –∏—Å—Ç–æ—Ä–∏—è –Ω–∞ –ø–ª–∞—â–∞–Ω–∏—è—Ç–∞',
    'Add': '–î–æ–±–∞–≤–∏',
    'Notes to kitchen/bar': '–ë–µ–ª–µ–∂–∫–∏ –∫—ä–º –∫—É—Ö–Ω—è—Ç–∞/–±–∞—Ä–∞',
    'Back to Tables': '–û–±—Ä–∞—Ç–Ω–æ –∫—ä–º –º–∞—Å–∏—Ç–µ'
  }
};

// Translation additions for alerts, toggles and small UI texts
Object.assign(i18n.en, {
  'No free table available. Select a table first.': 'No free table available. Select a table first.',
  'Select a table/order first': 'Select a table/order first',
  'Table not found': 'Table not found',
  'Item moved to': 'Item moved to',
  'Select an order first': 'Select an order first',
  'Payment completed:': 'Payment completed:',
  'sent to kitchen/bar.': 'sent to kitchen/bar.',
  'Print job sent (simulated).': 'Print job sent (simulated).',
  'Logged out successfully': 'Logged out successfully',
  'Are you sure you want to exit?': 'Are you sure you want to exit?',
  'Cash': 'Cash',
  'Card': 'Card',
  'Vouchers': 'Vouchers',
  'Online': 'Online',
  'No order selected': 'No order selected',
});
Object.assign(i18n.bg, {
  'No free table available. Select a table first.': '–ù—è–º–∞ —Å–≤–æ–±–æ–¥–Ω–∞ –º–∞—Å–∞. –ò–∑–±–µ—Ä–µ—Ç–µ –º–∞—Å–∞ –ø—ä—Ä–≤–æ.',
  'Select a table/order first': '–ò–∑–±–µ—Ä–µ—Ç–µ –º–∞—Å–∞/–ø–æ—Ä—ä—á–∫–∞ –ø—ä—Ä–≤–æ',
  'Table not found': '–ú–∞—Å–∞ –Ω–µ –µ –Ω–∞–º–µ—Ä–µ–Ω–∞',
  'Item moved to': '–ê—Ä—Ç–∏–∫—É–ª—ä—Ç –µ –ø—Ä–µ–º–µ—Å—Ç–µ–Ω –≤',
  'Select an order first': '–ò–∑–±–µ—Ä–µ—Ç–µ –ø–æ—Ä—ä—á–∫–∞ –ø—ä—Ä–≤–æ',
  'Payment completed:': '–ü–ª–∞—â–∞–Ω–µ—Ç–æ –µ –∑–∞–≤—ä—Ä—à–µ–Ω–æ:',
  'sent to kitchen/bar.': '–∏–∑–ø—Ä–∞—Ç–µ–Ω–æ –∫—ä–º –∫—É—Ö–Ω—è—Ç–∞/–±–∞—Ä–∞.',
  'Print job sent (simulated).': '–ó–∞–¥–∞—á–∞—Ç–∞ –∑–∞ –ø–µ—á–∞—Ç –µ –∏–∑–ø—Ä–∞—Ç–µ–Ω–∞ (—Å–∏–º—É–ª–∏—Ä–∞–Ω–æ).',
  'Logged out successfully': '–£—Å–ø–µ—à–Ω–æ –∏–∑–ª—è–∑–æ—Ö—Ç–µ –æ—Ç —Å–∏—Å—Ç–µ–º–∞—Ç–∞',
  'Are you sure you want to exit?': '–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑–ª–µ–∑–µ—Ç–µ?',
  'Cash': '–í –±—Ä–æ–π',
  'Card': '–ö–∞—Ä—Ç–∞',
  'Vouchers': '–í–∞—É—á–µ—Ä–∏',
  'Online': '–û–Ω–ª–∞–π–Ω',
  'No order selected': '–ù—è–º–∞ –∏–∑–±—Ä–∞–Ω–∞ –ø–æ—Ä—ä—á–∫–∞',
});
// Add missing translation keys for UI texts
// Ensure English translations are present too for completeness
Object.assign(i18n, {});
if (!i18n.en['Free']) i18n.en['Free'] = 'Free';
if (!i18n.bg['Free']) i18n.bg['Free'] = '–°–≤–æ–±–æ–¥–Ω–∞';
if (!i18n.en['Busy']) i18n.en['Busy'] = 'Busy';
if (!i18n.bg['Busy']) i18n.bg['Busy'] = '–ó–∞–µ—Ç–∞';
if (!i18n.en['Table']) i18n.en['Table'] = 'Table';
if (!i18n.bg['Table']) i18n.bg['Table'] = '–ú–∞—Å–∞';
if (!i18n.en['Order']) i18n.en['Order'] = 'Order';
if (!i18n.bg['Order']) i18n.bg['Order'] = '–ü–æ—Ä—ä—á–∫–∞';
if (!i18n.en['No order selected. Tap a table to start.']) i18n.en['No order selected. Tap a table to start.'] = 'No order selected. Tap a table to start.';
if (!i18n.bg['No order selected. Tap a table to start.']) i18n.bg['No order selected. Tap a table to start.'] = '–ù—è–º–∞ –∏–∑–±—Ä–∞–Ω–∞ –ø–æ—Ä—ä—á–∫–∞. –ù–∞—Ç–∏—Å–Ω–µ—Ç–µ –º–∞—Å–∞, –∑–∞ –¥–∞ –∑–∞–ø–æ—á–Ω–µ—Ç–µ.';
if (!i18n.en['Send']) i18n.en['Send'] = 'Send';
if (!i18n.bg['Send']) i18n.bg['Send'] = '–ò–∑–ø—Ä–∞—Ç–∏';
if (!i18n.en['Move']) i18n.en['Move'] = 'Move';
if (!i18n.bg['Move']) i18n.bg['Move'] = '–ü—Ä–µ–º–µ—Å—Ç–∏';
if (!i18n.en['Unknown']) i18n.en['Unknown'] = 'Unknown';
if (!i18n.bg['Unknown']) i18n.bg['Unknown'] = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
if (!i18n.en['No free table available. Select a table first.']) i18n.en['No free table available. Select a table first.'] = 'No free table available. Select a table first.';
if (!i18n.bg['No free table available. Select a table first.']) i18n.bg['No free table available. Select a table first.'] = '–ù—è–º–∞ —Å–≤–æ–±–æ–¥–Ω–∞ –º–∞—Å–∞. –ò–∑–±–µ—Ä–µ—Ç–µ –º–∞—Å–∞ –ø—ä—Ä–≤–æ.';
if (!i18n.en['sent to kitchen/bar.']) i18n.en['sent to kitchen/bar.'] = 'sent to kitchen/bar.';
if (!i18n.bg['sent to kitchen/bar.']) i18n.bg['sent to kitchen/bar.'] = '–∏–∑–ø—Ä–∞—Ç–µ–Ω–æ –∫—ä–º –∫—É—Ö–Ω—è—Ç–∞/–±–∞—Ä–∞.';
if (!i18n.en['Select a table/order first']) i18n.en['Select a table/order first'] = 'Select a table/order first';
if (!i18n.bg['Select a table/order first']) i18n.bg['Select a table/order first'] = '–ò–∑–±–µ—Ä–µ—Ç–µ –º–∞—Å–∞/–ø–æ—Ä—ä—á–∫–∞ –ø—ä—Ä–≤–æ';
if (!i18n.en['Table not found']) i18n.en['Table not found'] = 'Table not found';
if (!i18n.bg['Table not found']) i18n.bg['Table not found'] = '–ú–∞—Å–∞ –Ω–µ –µ –Ω–∞–º–µ—Ä–µ–Ω–∞';
if (!i18n.en['Item moved to']) i18n.en['Item moved to'] = 'Item moved to';
if (!i18n.bg['Item moved to']) i18n.bg['Item moved to'] = '–ê—Ä—Ç–∏–∫—É–ª—ä—Ç –µ –ø—Ä–µ–º–µ—Å—Ç–µ–Ω –≤';
if (!i18n.en['Payment completed:']) i18n.en['Payment completed:'] = 'Payment completed:';
if (!i18n.bg['Payment completed:']) i18n.bg['Payment completed:'] = '–ü–ª–∞—â–∞–Ω–µ—Ç–æ –µ –∑–∞–≤—ä—Ä—à–µ–Ω–æ:';
if (!i18n.en['Print job sent (simulated).']) i18n.en['Print job sent (simulated).'] = 'Print job sent (simulated).';
if (!i18n.bg['Print job sent (simulated).']) i18n.bg['Print job sent (simulated).'] = '–ó–∞–¥–∞—á–∞—Ç–∞ –∑–∞ –ø–µ—á–∞—Ç –µ –∏–∑–ø—Ä–∞—Ç–µ–Ω–∞ (—Å–∏–º—É–ª–∏—Ä–∞–Ω–æ).';
if (!i18n.en['Logged out successfully']) i18n.en['Logged out successfully'] = 'Logged out successfully';
if (!i18n.bg['Logged out successfully']) i18n.bg['Logged out successfully'] = '–£—Å–ø–µ—à–Ω–æ –∏–∑–ª—è–∑–æ—Ö—Ç–µ –æ—Ç —Å–∏—Å—Ç–µ–º–∞—Ç–∞';

/* ---------- State (in-memory, mock data) ---------- */
let lang = 'en';

// Simple tables dataset
const tables = [
  { id: 1, name: 'Table 1', status: 'free', orderId: null },
  { id: 2, name: 'Table 2', status: 'busy', orderId: 101 },
  { id: 3, name: 'Table 3', status: 'ready', orderId: 102 },
  { id: 4, name: 'Table 4', status: 'busy', orderId: 103 },
  { id: 5, name: 'Table 5', status: 'free', orderId: null },
  { id: 6, name: 'Table 6', status: 'free', orderId: null }
];

// Orders map (id -> order)
const orders = {
  101: { id: 101, table: 2, items: [{ name: 'Margherita', meta: 'Tomato, mozzarella', price: 11.5 }], payments: [], tip: 0, comments: '' },
  102: { id: 102, table: 3, items: [{ name: 'Coca-Cola', meta: '330 ml', price: 3.0 }], payments: [], tip: 0, comments: '' },
  103: { id: 103, table: 4, items: [{ name: 'Burger', meta: 'Medium', price: 12.0 }], payments: [], tip: 0, comments: '' }
};

let nextOrderId = 200;
let currentOrder = null; // pointer to currently open order (object in orders) or null

// Menu items by category
const menu = {
  pizzas: [
    { name: 'Margherita', price: 11.5 }, 
    { name: 'Pepperoni', price: 12.5 },
    { name: 'Quattro Formaggi', price: 13.0 }
  ],
  drinks: [
    { name: 'Coca-Cola', price: 3.0 }, 
    { name: 'Water', price: 1.5 },
    { name: 'Orange Juice', price: 4.0 }
  ],
  sides: [
    { name: 'Fries', price: 4.0 }, 
    { name: 'Green Salad', price: 4.5 },
    { name: 'Garlic Bread', price: 3.5 }
  ]
};

// Delivery mock
const deliveries = [
  { id: 1234, status: 'preparing' },
  { id: 1235, status: 'ready' },
  { id: 1236, status: 'picked' }
];

/* ---------- DOM references ---------- */
const langSelect = document.getElementById('langSelect');
const bottomNavButtons = document.querySelectorAll('nav.bottom-nav button'); // FIXED: Changed from nav.sidebar li
const views = document.querySelectorAll('.view');
const tablesGrid = document.getElementById('tablesGrid');
const tplTable = document.getElementById('tplTableChip');
const tplMenuItem = document.getElementById('tplMenuItem');

const orderTitle = document.getElementById('orderTitle');
const orderItemsEl = document.getElementById('orderItems');
const totalValueEl = document.getElementById('totalValue');
const amountValueEl = document.getElementById('amountValue');

const paymentTypeButtons = document.querySelectorAll('.pay-btn');
const tipButtons = document.querySelectorAll('.tip-btn');
const customTipInput = document.getElementById('customTip');
const commentsInput = document.getElementById('comments');
const completePaymentBtn = document.getElementById('completePayment');

const menuItemsEl = document.getElementById('menuItems');
const categoryButtons = document.querySelectorAll('.cat-btn');

const checksList = document.getElementById('checksList');
const deliveryList = document.getElementById('deliveryList');

/* ---------- Utility functions ---------- */
function t(key) {
  return (i18n[lang] && i18n[lang][key]) ? i18n[lang][key] : key;
}

function changeView(name) {
  // mark nav buttons as active
  bottomNavButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.view === name));
  // show view
  views.forEach(v => v.classList.toggle('active', v.id === 'view-' + name));
}

/* ---------- Rendering ---------- */
function renderNavLabels() {
  // update bottom navigation labels based on language
  bottomNavButtons.forEach(btn => {
    const map = { 
      tables: 'Tables', 
      orders: 'Orders', 
      payments: 'Payments', 
      delivery: 'Delivery/Takeaway', 
      stats: 'Statistics' 
    };
    const key = map[btn.dataset.view];
    const labelEl = btn.querySelector('span:last-child');
    if (labelEl) labelEl.textContent = t(key);
  });
  
  // Header title
  const appTitle = document.getElementById('appTitle');
  if (appTitle) appTitle.textContent = t('Waiter Dashboard');
  
  // Exit button
  const exitBtn = document.getElementById('exitBtn');
  if (exitBtn) exitBtn.textContent = t('Exit');
  
  // Pay button in navigation
  const navPay = document.getElementById('navPay');
  if (navPay) navPay.textContent = t('Pay');
  
  document.getElementById('tablesTitle').textContent = t('Tables');
  document.getElementById('tablesSubtitle').textContent = t('Tap a table to open or create an order');
  const backToTablesLabel = document.getElementById('backToTablesLabel');
  if (backToTablesLabel) backToTablesLabel.textContent = t('Back to Tables');
  document.getElementById('labelTotal').textContent = t('Total');
  document.getElementById('labelAmount').textContent = t('Amount');
  document.getElementById('labelTip').textContent = t('Tip');
  document.getElementById('labelComments').textContent = t('Comments');
  document.getElementById('completePayment').textContent = t('Complete Payment');
  document.getElementById('menuTitle').textContent = t('Menu');
  
  // Category buttons
  const catPizzas = document.getElementById('catPizzas');
  if (catPizzas) catPizzas.textContent = t('Pizzas');
  const catDrinks = document.getElementById('catDrinks');
  if (catDrinks) catDrinks.textContent = t('Drinks');
  const catSides = document.getElementById('catSides');
  if (catSides) catSides.textContent = t('Sides');
  
  const deliverySubtitle = document.querySelector('#view-delivery .muted');
  if (deliverySubtitle) deliverySubtitle.textContent = t('Incoming Orders');
  
  document.getElementById('btnPrintOrders').textContent = t('Print Orders');
  
  // section titles
  const paymentsTitle = document.getElementById('paymentsTitle');
  if (paymentsTitle) paymentsTitle.textContent = t('Payments');
  const paymentsSubtitle = document.querySelector('#view-payments .muted');
  if (paymentsSubtitle) paymentsSubtitle.textContent = t('Open checks and payment history');
  
  const deliveryTitle = document.getElementById('deliveryTitle');
  if (deliveryTitle) deliveryTitle.textContent = t('Delivery/Takeaway');
  const statsTitle = document.getElementById('statsTitle');
  if (statsTitle) statsTitle.textContent = t('Statistics');
  
  // Statistics labels
  const statSalesLabel = document.getElementById('statSalesLabel');
  if (statSalesLabel) statSalesLabel.textContent = t('Sales this shift');
  const statAvgLabel = document.getElementById('statAvgLabel');
  if (statAvgLabel) statAvgLabel.textContent = t('Average check');
  const statTablesLabel = document.getElementById('statTablesLabel');
  if (statTablesLabel) statTablesLabel.textContent = t('Served tables');
  const statTipsLabel = document.getElementById('statTipsLabel');
  if (statTipsLabel) statTipsLabel.textContent = t('Tips (total)');

  // payment type buttons
  document.querySelectorAll('.pay-btn').forEach(btn => {
    const type = btn.dataset.type;
    // translate using i18n with capitalized key (e.g., 'cash' => 'Cash')
    const labelKey = type ? type.charAt(0).toUpperCase() + type.slice(1) : '';
    if (labelKey) btn.textContent = t(labelKey);
  });
  
  // Payments block title
  const paymentsBlockTitle = document.getElementById('paymentsBlockTitle');
  if (paymentsBlockTitle) paymentsBlockTitle.textContent = t('Payments');
  
  // Comments textarea placeholder
  const commentsInput = document.getElementById('comments');
  if (commentsInput) {
    commentsInput.placeholder = t('Notes to kitchen/bar');
  }
  
  // Custom tip input placeholder
  const customTipInput = document.getElementById('customTip');
  if (customTipInput) {
    customTipInput.placeholder = lang === 'bg' ? '‚Ç¨ 0,00' : '‚Ç¨ 0.00';
  }

  // ensure language select matches the current lang
  if (langSelect) langSelect.value = lang;
}

function renderTables() {
  tablesGrid.innerHTML = '';
  tables.forEach(tb => {
    const chip = tplTable.content.firstElementChild.cloneNode(true);
    let chipName = tb.name;
    if (chipName && chipName.startsWith('Table ')) {
      const parts = chipName.split(' ');
      chipName = `${t('Table')} ${parts.slice(1).join(' ')}`;
    }
    chip.querySelector('.name').textContent = chipName;
    // Translate status label
    let statusKey = '';
    if (tb.status === 'free') statusKey = 'Free';
    else if (tb.status === 'busy') statusKey = 'Busy';
    else if (tb.status === 'ready') statusKey = 'Ready';
    chip.querySelector('.status').textContent = t(statusKey);
    chip.classList.remove('free', 'busy', 'ready');
    
    if (tb.status === 'free') chip.classList.add('free');
    if (tb.status === 'busy') chip.classList.add('busy');
    if (tb.status === 'ready') chip.classList.add('ready');

    chip.addEventListener('click', () => {
      onTableClick(tb.id);
    });
    
    tablesGrid.appendChild(chip);
  });
}

function renderMenu(cat = 'pizzas') {
  menuItemsEl.innerHTML = '';
  menu[cat].forEach(mi => {
    const el = tplMenuItem.content.firstElementChild.cloneNode(true);
    // Translate menu item name
    const translatedName = t(mi.name) || mi.name;
    el.querySelector('.mname').textContent = translatedName;
    el.querySelector('.mprice').textContent = mi.price.toFixed(2) + '‚Ç¨';
    const addBtn = el.querySelector('button.add');
    
    // Translate "Add" button
    const addBtnText = lang === 'bg' ? '+ ' + t('Add') : '+ ' + t('Add');
    addBtn.textContent = addBtnText;
    
    addBtn.addEventListener('click', () => {
      if (!currentOrder) {
        // open new order at first free table
        const freeTable = tables.find(t => t.status === 'free');
        if (freeTable) {
          createOrderForTable(freeTable.id);
        } else {
          alert(t('No free table available. Select a table first.'));
          return;
        }
      }
      // Store original name for data consistency, but display translated name
      addItemToOrder(currentOrder.id, { name: mi.name, meta: '', price: mi.price, translatedName: translatedName });
    });
    
    menuItemsEl.appendChild(el);
  });
}

function renderOrderPanel() {
  if (!currentOrder) {
    orderTitle.textContent = t('Orders');
    orderItemsEl.innerHTML = '<div class="muted">' + t('No order selected. Tap a table to start.') + '</div>';
    totalValueEl.textContent = '0.00‚Ç¨';
    amountValueEl.textContent = '0.00‚Ç¨';
    commentsInput.value = '';
    return;
  }

  const table = tables.find(t => t.id === currentOrder.table);
  const tableLabel = table ? (table.name && table.name.startsWith('Table ') ? `${t('Table')} ${table.name.split(' ')[1]}` : table.name) : t('Unknown');
  orderTitle.textContent = `${t('Order')} #${currentOrder.id} ‚Äî ${tableLabel}`;
  orderItemsEl.innerHTML = '';
  let total = 0;
  
  currentOrder.items.forEach((it, idx) => {
    const row = document.createElement('div');
    row.className = 'order-item';
    // Use translated name if available, otherwise translate the original name
    const displayName = it.translatedName || t(it.name) || it.name;
    row.innerHTML = `
      <div class="left">
        <div class="name">${displayName}</div>
        <div class="meta">${it.meta || ''}</div>
      </div>
      <div class="right">
        <div class="price">${it.price.toFixed(2)}‚Ç¨</div>
        <div style="margin-top:8px; text-align:right;">
          <button data-idx="${idx}" class="small send-btn" style="margin-right:8px; padding:6px 10px; border-radius:8px; border:1px solid var(--border); background:#fff; font-size:12px; font-weight:600;">${t('Send')}</button>
          <button data-idx="${idx}" class="small move-btn" style="padding:6px 10px; border-radius:8px; border:1px solid var(--border); background:#fff; font-size:12px; font-weight:600;">${t('Move')}</button>
        </div>
      </div>
    `;
    orderItemsEl.appendChild(row);
    total += it.price;
  });

  totalValueEl.textContent = total.toFixed(2) + '‚Ç¨';
  amountValueEl.textContent = (total + (currentOrder.tip || 0)).toFixed(2) + '‚Ç¨';
  commentsInput.value = currentOrder.comments || '';

  // wire send/move
  orderItemsEl.querySelectorAll('.send-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const idx = +e.target.dataset.idx;
      const item = currentOrder.items[idx];
      const itemName = item.translatedName || t(item.name) || item.name;
      alert(`${itemName} ${t('sent to kitchen/bar.')}`);
    });
  });
  
  orderItemsEl.querySelectorAll('.move-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const idx = +e.target.dataset.idx;
      transferItemToTable(idx);
    });
  });
}

function renderChecksList() {
  checksList.innerHTML = '';
  Object.values(orders).forEach(o => {
    const row = document.createElement('div');
    row.className = 'menu-item';
    const price = o.items.reduce((s, i) => s + i.price, 0);
    row.innerHTML = `
      <div>
        <strong>${t('Order')} #${o.id}</strong>
        <div class="muted">${t('Table')} ${o.table}</div>
      </div>
      <div>${price.toFixed(2)}‚Ç¨</div>
    `;
    checksList.appendChild(row);
  });
}

function renderDeliveries() {
  deliveryList.innerHTML = '';
  deliveries.forEach(d => {
    const row = document.createElement('div');
    row.className = 'delivery-row';
    const label = document.createElement('div');
    label.textContent = `${t('Order')} #${d.id}`;
    const btn = document.createElement('button');
    btn.className = 'status';
    
    if (d.status === 'preparing') { 
      btn.textContent = t('Preparing'); 
      btn.style.background = 'var(--accent-orange)'; 
    } else if (d.status === 'ready') { 
      btn.textContent = t('Ready'); 
      btn.style.background = 'var(--accent-green)'; 
      btn.style.color = '#063b12'; 
    } else { 
      btn.textContent = t('Picked up'); 
      btn.style.background = 'var(--accent-darkgreen)'; 
    }
    
    btn.addEventListener('click', () => {
      if (d.status === 'preparing') d.status = 'ready';
      else if (d.status === 'ready') d.status = 'picked';
      renderDeliveries();
    });
    
    row.appendChild(label);
    row.appendChild(btn);
    deliveryList.appendChild(row);
  });
}

function renderStats() {
  const served = Object.values(orders).length;
  const sales = Object.values(orders).reduce((s, o) => s + o.items.reduce((a, i) => a + i.price, 0), 0);
  const tips = Object.values(orders).reduce((s, o) => s + (o.tip || 0), 0);
  
  document.getElementById('statSales').textContent = sales.toFixed(2) + '‚Ç¨';
  document.getElementById('statAvg').textContent = (served ? (sales / served).toFixed(2) + '‚Ç¨' : '0.00‚Ç¨');
  document.getElementById('statTables').textContent = served;
  document.getElementById('statTips').textContent = `${tips.toFixed(2)}‚Ç¨ / ${served ? (tips / served).toFixed(2) + '‚Ç¨' : '0.00‚Ç¨'}`;
}

/* ---------- Actions ---------- */

function onTableClick(tableId) {
  const table = tables.find(t => t.id === tableId);
  if (!table) return;

  if (!table.orderId) {
    // create new order
    createOrderForTable(tableId);
  } else {
    // open existing order
    currentOrder = orders[table.orderId];
  }

  // switch to orders view and render
  changeView('orders');
  renderOrderPanel();
  renderMenu('pizzas');
}

function createOrderForTable(tableId) {
  const oid = nextOrderId++;
  orders[oid] = { id: oid, table: tableId, items: [], payments: [], tip: 0, comments: '' };
  const tb = tables.find(t => t.id === tableId);
  tb.orderId = oid;
  tb.status = 'busy';
  currentOrder = orders[oid];
  renderTables();
}

function addItemToOrder(orderId, item) {
  if (!orders[orderId]) return;
  orders[orderId].items.push(item);
  renderOrderPanel();
  renderChecksList();
}

function transferItemToTable(idx) {
  if (!currentOrder) return alert(t('Select a table/order first'));
  const dest = prompt('Enter destination table id:');
  const tid = parseInt(dest);
  if (isNaN(tid)) return;
  const ttable = tables.find(t => t.id === tid);
  if (!ttable) return alert(t('Table not found'));
  
  const it = currentOrder.items.splice(idx, 1)[0];
  if (!ttable.orderId) {
    const oid = nextOrderId++;
    orders[oid] = { id: oid, table: tid, items: [], payments: [], tip: 0, comments: '' };
    ttable.orderId = oid;
    ttable.status = 'busy';
  }
  
  orders[ttable.orderId].items.push(it);
  renderOrderPanel();
  renderTables();
  renderChecksList();
  let tableLabel = ttable.name;
  if (tableLabel && tableLabel.startsWith('Table ')) {
    const parts = tableLabel.split(' ');
    tableLabel = `${t('Table')} ${parts.slice(1).join(' ')}`;
  }
  alert(`${t('Item moved to')} ${tableLabel}`);
}

// Payment logic (simulated)
function completePayment() {
  if (!currentOrder) return alert(t('Select an order first'));
  
  // choose selected payment type
  const selectedPay = Array.from(paymentTypeButtons).find(btn => btn.classList.contains('active'));
  const payType = selectedPay ? selectedPay.dataset.type : 'cash';
  const subtotal = currentOrder.items.reduce((s, i) => s + i.price, 0);
  const tip = parseFloat(currentOrder.tip || 0);
  const total = +(subtotal + tip).toFixed(2);

  currentOrder.payments.push({ type: payType, amount: total });
  
  // free table
  const tb = tables.find(t => t.id === currentOrder.table);
  if (tb) { 
    tb.orderId = null; 
    tb.status = 'free'; 
  }
  
  // remove order from active orders (simulate closing)
  delete orders[currentOrder.id];

  currentOrder = null;
  const payLabel = (payType ? t(payType.charAt(0).toUpperCase() + payType.slice(1)) : payType);
  alert(`${t('Payment completed:')} ${total.toFixed(2)}‚Ç¨ (${payLabel})`);
  renderTables();
  renderOrderPanel();
  renderChecksList();
  renderStats();
}

/* ---------- Wire UI events ---------- */

// FIXED: Bottom navigation clicks
bottomNavButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    changeView(btn.dataset.view);
  });
});

// language switch
  langSelect.addEventListener('change', (e) => {
  lang = e.target.value;
  renderAll();
});

// Back to tables button
document.getElementById('backToTablesBtn')?.addEventListener('click', () => {
  changeView('tables');
});

// payment type toggle
paymentTypeButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    paymentTypeButtons.forEach(x => x.classList.remove('active'));
    btn.classList.add('active');
  });
});
// default selection
if (paymentTypeButtons.length > 0) {
  paymentTypeButtons[0].classList.add('active');
}

// tip buttons
tipButtons.forEach(b => {
  b.addEventListener('click', () => {
    if (!currentOrder) return alert(t('Select an order first'));
    const rate = parseFloat(b.dataset.tip);
    const subtotal = currentOrder.items.reduce((s, i) => s + i.price, 0);
    currentOrder.tip = +(subtotal * rate).toFixed(2);
    customTipInput.value = currentOrder.tip ? currentOrder.tip.toFixed(2) : '';
    renderOrderPanel();
  });
});

// custom tip input
customTipInput.addEventListener('input', () => {
  if (!currentOrder) return;
  const val = parseFloat(customTipInput.value) || 0;
  currentOrder.tip = +val;
  renderOrderPanel();
});

// complete payment
completePaymentBtn.addEventListener('click', () => {
  if (!currentOrder) return alert(t('No order selected'));
  currentOrder.comments = commentsInput.value;
  completePayment();
});

// menu categories
categoryButtons.forEach(cb => {
  cb.addEventListener('click', () => {
    categoryButtons.forEach(x => x.classList.remove('active'));
    cb.classList.add('active');
    renderMenu(cb.dataset.cat);
  });
});

// print orders (simulated)
document.getElementById('btnPrintOrders')?.addEventListener('click', () => {
  alert(t('Print job sent (simulated).'));
});

// Exit button
document.getElementById('exitBtn')?.addEventListener('click', () => {
  if (confirm(t('Are you sure you want to exit?'))) {
    alert(t('Logged out successfully'));
    // In a real app, would redirect to login
  }
});

/* ---------- Initial render ---------- */
function renderAll() {
  renderNavLabels();
  renderTables();
  renderMenu('pizzas');
  renderOrderPanel();
  renderChecksList();
  renderDeliveries();
  renderStats();
}

// Initialize on load
renderAll();

/****************************************************************
 * End of script
 ****************************************************************/
  </script>
</body>
</html>
